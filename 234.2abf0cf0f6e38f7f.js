"use strict";(self.webpackChunkrelevent=self.webpackChunkrelevent||[]).push([[234],{9234:(L,Z,o)=>{o.r(Z),o.d(Z,{EventsModule:()=>f});var u=o(6895),y=o(4966),t=o(4650),T=o(2308),S=o(6290),b=o(6526);function P(r,e){if(1&r&&(t.ynx(0),t.TgZ(1,"div",6)(2,"div",7),t._uU(3),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.qZA(),t.TgZ(6,"div",9),t._UZ(7,"img",10),t.qZA(),t.TgZ(8,"div",11),t._uU(9),t.ALo(10,"date"),t.qZA()(),t.BQk()),2&r){const n=e.ngIf;t.xp6(3),t.Oqu(n.title),t.xp6(2),t.Oqu(n.description),t.xp6(2),t.Q6J("src",n.imgUrl,t.LSH)("alt",n.title),t.xp6(2),t.Oqu(t.lcZ(10,5,n.date))}}class m{constructor(e,n){this.activatedRoute=e,this.eventsService=n,this.id=this.activatedRoute.snapshot.params.id,this.eventConcert$=this.eventsService.getEventConcertById(this.id)}}m.\u0275fac=function(e){return new(e||m)(t.Y36(y.gz),t.Y36(T.n))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-page-event"]],decls:8,vars:3,consts:[[1,"page"],[1,"header"],[1,"main"],[1,"section","section_event"],[1,"container"],[4,"ngIf"],[1,"event-card"],[1,"event-card__title"],[1,"event-card__description"],[1,"event-card__img-wrapper"],[1,"event-card__img",3,"src","alt"],[1,"event-card__date"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-header",1),t.TgZ(2,"main",2)(3,"section",3)(4,"div",4),t.YNc(5,P,11,7,"ng-container",5),t.ALo(6,"async"),t.qZA()()(),t._UZ(7,"app-footer"),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngIf",t.lcZ(6,1,n.eventConcert$)))},dependencies:[u.O5,S.G,b.c,u.Ov,u.uU],styles:['.main[_ngcontent-%COMP%]{padding:40px 0}.event-card[_ngcontent-%COMP%]{display:grid;grid-template-areas:"event-card__img-wrapper event__title" "event-card__img-wrapper event__description" "event-card__img-wrapper event__date";grid-template-columns:minmax(50px,300px) auto;grid-auto-rows:auto;place-items:center center;max-width:600px;margin:0 auto}.event-card__img-wrapper[_ngcontent-%COMP%]{grid-area:event-card__img-wrapper;align-self:flex-start}.event-card__title[_ngcontent-%COMP%]{grid-area:event__title;font-size:1.5em}.event-card__description[_ngcontent-%COMP%]{grid-area:event__description}.event-card__date[_ngcontent-%COMP%]{grid-area:event__date}']});var w=o(590),c=o(4006),A=o(384),D=o(6391),E=o(1135);const U=(r,e)=>{const n=new Date(r.getFullYear(),r.getMonth(),r.getDate()),i=new Date(e.getFullYear(),e.getMonth(),e.getDate());return n.getTime()>i.getTime()?1:n.getTime()<i.getTime()?-1:0};var x=o(3238);class v{constructor(e,n,i){this.dateAdapter=e,this.authService=n,this.userService=i,this._behSubjEvents=new E.X([]),this._initialEvents=[],this.filteredEvents$=this._behSubjEvents.asObservable(),this.filteredEventsByDateBehSubj=new E.X([]),this.filteredEventsByTitleBehSubj=new E.X([]),this.filteredEventsByDescriptionBehSubj=new E.X([])}initEvents(e){this._initialEvents=e,this.authService.updateEventsByUser(e);const n=this.authService._user$.value;null!==n&&this.userService.updateEventsByUser(n,e),this.filteredEventsByDateBehSubj.next(this._initialEvents),this.filteredEventsByTitleBehSubj.next(this._initialEvents),this.filteredEventsByDescriptionBehSubj.next(this._initialEvents),this.filterByAll(),this._behSubjEvents.next(e)}filterByDateRange(e){if(null===e)return this.filteredEventsByDateBehSubj.next(this._initialEvents),this.filterByAll(),[];const n=this._initialEvents,i=[];for(const a of n){const l=new Date(a.date),s=U(e.start,l),d=U(e.end,l);(0===s||-1===s)&&(0===d||1===d)&&i.push(a)}return this.filteredEventsByDateBehSubj.next(i),this.filterByAll(),i}filterByDescription(e){const i=this.getMatchingObjects(this._initialEvents,e,"description");return this.filteredEventsByDescriptionBehSubj.next(i),this.filterByAll(),i}filterByTitle(e){const i=this.getMatchingObjects(this._initialEvents,e,"title");return this.filteredEventsByTitleBehSubj.next(i),this.filterByAll(),i}getMatchingObjects(e,n,i){if(!(i in e[0]))throw new Error(`Key "${i}" does not exist in the objects`);const a=n.replace(/\s+/g," ").trim(),l=new RegExp(a,"i");return e.filter(s=>{const d=s[i].replace(/\s+/g," ").trim();return l.test(d)})}filterByAll(){const a=this.filterEventConcertPages(this.filteredEventsByDateBehSubj.value,this.filteredEventsByTitleBehSubj.value,this.filteredEventsByDescriptionBehSubj.value);return this._behSubjEvents.next(a),a}filterEventConcertPages(...e){const i=[].concat(...e).reduce((s,d)=>{const C=new Date(d.date),B=[d.title,d.description,C].join(",");return s[B]?s[B].quantity++:s[B]={quantity:1,event:d},s},{});return Object.values(i).map(s=>s.event).filter(s=>{const d=new Date(s.date),C=[s.title,s.description,d].join(",");return i[C].quantity===e.length})}}v.\u0275fac=function(e){return new(e||v)(t.LFG(x._A),t.LFG(A.e),t.LFG(D.K))},v.\u0275prov=t.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"});var j=o(4859),h=o(9549),O=o(4144),p=o(543);function F(r,e){1&r&&(t.TgZ(0,"mat-error"),t._uU(1,"Invalid start date"),t.qZA())}function I(r,e){1&r&&(t.TgZ(0,"mat-error"),t._uU(1,"Invalid end date"),t.qZA())}const M=function(r){return{btn_buyed:r}};function J(r,e){if(1&r){const n=t.EpF();t.ynx(0),t.TgZ(1,"div",18),t._UZ(2,"img",19),t.TgZ(3,"div",20),t._uU(4),t.qZA(),t.TgZ(5,"div",21),t._uU(6),t.ALo(7,"date"),t.qZA(),t.TgZ(8,"div",22),t._uU(9),t.qZA(),t.TgZ(10,"div",23)(11,"button",24),t.NdJ("click",function(){const l=t.CHM(n).$implicit,s=t.oxw(3);return t.KtG(s.changeQuantityEvent("-",l))}),t._uU(12,"-"),t.qZA(),t.TgZ(13,"span"),t._uU(14),t.qZA(),t.TgZ(15,"button",25),t.NdJ("click",function(){const l=t.CHM(n).$implicit,s=t.oxw(3);return t.KtG(s.changeQuantityEvent("+",l))}),t._uU(16,"+"),t.qZA()(),t.TgZ(17,"button",26),t.NdJ("click",function(){const l=t.CHM(n).$implicit,s=t.oxw(3);return t.KtG(s.addEventConcertToUser(l))}),t._uU(18),t.qZA()(),t.BQk()}if(2&r){const n=e.$implicit;t.xp6(1),t.uIk("data-card-id",n.id),t.xp6(1),t.Q6J("routerLink",n.id)("src",n.imgUrl,t.LSH),t.xp6(1),t.Q6J("routerLink",n.id),t.xp6(1),t.hij(" ",n.title," "),t.xp6(2),t.hij(" ",t.xi3(7,12,n.date,"medium")," "),t.xp6(3),t.hij(" ",n.description," "),t.xp6(2),t.Q6J("disabled",n.buyed),t.xp6(3),t.hij(" ",n.quantity," "),t.xp6(1),t.Q6J("disabled",n.buyed),t.xp6(2),t.Q6J("ngClass",t.VKq(15,M,n.buyed)),t.xp6(1),t.hij(" ",n.buyed?"Purchased":"Buy"," ")}}function N(r,e){if(1&r&&(t.ynx(0),t.YNc(1,J,19,17,"ng-container",17),t.BQk()),2&r){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("ngForOf",n)}}function Q(r,e){if(1&r&&(t.ynx(0),t.YNc(1,N,2,1,"ng-container",15),t.BQk()),2&r){const n=e.ngIf;t.xp6(1),t.Q6J("ngIf",0!==n.length)}}class _{constructor(e,n,i,a){this.eventsService=e,this.authService=n,this.userService=i,this.eventsFilterService=a,this.eventConcerts$=this.eventsService.getEventConcertsByUser(this.authService.user$),this.filteredEventConcerts$=this.eventsFilterService.filteredEvents$,this.user$=this.authService.user$,this.form=new c.cw({rangeDate:new c.cw({start:new c.NI(null),end:new c.NI(null)}),description:new c.NI(null),title:new c.NI(null)})}ngOnInit(){this.eventConcerts$.subscribe(e=>{const n=e.map(i=>(i.buyed||(i.buyed=!1),i));this.eventsFilterService.initEvents(n)})}filterDate(){const e={start:this.form.controls.rangeDate.controls.start.value,end:this.form.controls.rangeDate.controls.end.value};this.eventsFilterService.filterByDateRange(null!==e.start&&null!==e.end?e:null)}filterTitle(){const e=this.form.controls.title.value;null!==e&&this.eventsFilterService.filterByTitle(e)}filterDescription(){const e=this.form.controls.description.value;null!==e&&this.eventsFilterService.filterByDescription(e)}addEventConcertToUser(e){this.user$.pipe((0,w.P)()).subscribe(n=>{if(null!==n)if(console.log(e),!0===e.buyed){e.buyed=!1;const i=Object.assign({},e),a=this.userService.removeEventConcertByUserEmail(n,i);null!==a&&this.authService.updateUser(a)}else if(!e.buyed){e.buyed=!0;const i=Object.assign({},e),a=this.userService.addEventConcertByUserEmail(n,i);null!==a&&this.authService.updateUser(a)}})}changeQuantityEvent(e,n){"+"===e?n.quantity++:"-"===e&&n.quantity>1&&n.quantity--}}_.\u0275fac=function(e){return new(e||_)(t.Y36(T.n),t.Y36(A.e),t.Y36(D.K),t.Y36(v))},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-page-events"]],decls:30,vars:9,consts:[[1,"page"],[1,"header"],[1,"main"],[1,"section","section_events"],[1,"container"],[1,"events"],[1,"form-filter",3,"formGroup"],["matInput","","formControlName","title",3,"input"],["matInput","","formControlName","description",3,"input"],["appearance","fill"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"dateChange"],["matIconSuffix","",3,"for"],["picker",""],[4,"ngIf"],[1,"event-card-wrapper"],[4,"ngFor","ngForOf"],[1,"event-card"],[1,"event-card__img",3,"routerLink","src"],[1,"event-card__title",3,"routerLink"],[1,"event-card__date"],[1,"event-card__description"],[1,"event-card__quantity"],["mat-raised-button","","color","primary",1,"btn_minus",3,"disabled","click"],["mat-raised-button","","color","primary",1,"btn_plus",3,"disabled","click"],["mat-raised-button","","color","primary",3,"ngClass","click"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0),t._UZ(1,"app-header",1),t.TgZ(2,"main",2)(3,"section",3)(4,"div",4)(5,"div",5)(6,"form",6)(7,"mat-form-field")(8,"mat-label"),t._uU(9,"Filter by title"),t.qZA(),t.TgZ(10,"input",7),t.NdJ("input",function(){return n.filterTitle()}),t.qZA()(),t.TgZ(11,"mat-form-field")(12,"mat-label"),t._uU(13,"Filter by description"),t.qZA(),t.TgZ(14,"input",8),t.NdJ("input",function(){return n.filterDescription()}),t.qZA()(),t.TgZ(15,"mat-form-field",9)(16,"mat-label"),t._uU(17,"Enter a date range"),t.qZA(),t.TgZ(18,"mat-date-range-input",10),t._UZ(19,"input",11),t.TgZ(20,"input",12),t.NdJ("dateChange",function(){return n.filterDate()}),t.qZA()(),t._UZ(21,"mat-datepicker-toggle",13)(22,"mat-date-range-picker",null,14),t.YNc(24,F,2,0,"mat-error",15),t.YNc(25,I,2,0,"mat-error",15),t.qZA()(),t.TgZ(26,"div",16),t.YNc(27,Q,2,1,"ng-container",15),t.ALo(28,"async"),t.qZA()()()()(),t._UZ(29,"app-footer"),t.qZA()),2&e){const i=t.MAs(23);t.xp6(6),t.Q6J("formGroup",n.form),t.xp6(12),t.Q6J("formGroup",n.form.controls.rangeDate)("rangePicker",i),t.xp6(3),t.Q6J("for",i),t.xp6(3),t.Q6J("ngIf",n.form.controls.rangeDate.controls.start.hasError("matStartDateInvalid")),t.xp6(1),t.Q6J("ngIf",n.form.controls.rangeDate.controls.end.hasError("matEndDateInvalid")),t.xp6(2),t.Q6J("ngIf",t.lcZ(28,7,n.filteredEventConcerts$))}},dependencies:[u.mk,u.sg,u.O5,y.rH,S.G,b.c,j.lW,h.KE,h.hX,h.TO,h.R9,O.Nt,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,p.nW,p.wx,p.zY,p.By,p._g,u.Ov,u.uU],styles:[".section_events[_ngcontent-%COMP%]{padding:40px 0}.event-card-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,200px);justify-content:center;gap:50px}.event-card[_ngcontent-%COMP%]{display:grid;grid-auto-rows:auto;place-items:start;gap:10px}.event-card__title[_ngcontent-%COMP%], .event-card__img[_ngcontent-%COMP%]{cursor:pointer}.event-card__quantity[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.form-filter[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,200px);justify-content:center;grid-auto-rows:auto;gap:20px;margin:0 auto 50px}"]});const q=[{path:"",component:_},{path:":id",component:m}];class g{}g.\u0275fac=function(e){return new(e||g)},g.\u0275mod=t.oAB({type:g}),g.\u0275inj=t.cJS({imports:[y.Bz.forChild(q),y.Bz]});var $=o(9718),Y=o(2735);class f{}f.\u0275fac=function(e){return new(e||f)},f.\u0275mod=t.oAB({type:f}),f.\u0275inj=t.cJS({providers:[{provide:x.Ad,useValue:"en-GB"}],imports:[u.ez,g,$.O,Y._,j.ot,h.lN,O.c,c.UX,p.FA,x.XK]})}}]);